<p align="center">
  <img src="https://img.shields.io/badge/Django-6.0-092E20?style=for-the-badge&logo=django&logoColor=white" alt="Django 6.0"/>
  <img src="https://img.shields.io/badge/Python-3.13-3776AB?style=for-the-badge&logo=python&logoColor=white" alt="Python 3.13"/>
  <img src="https://img.shields.io/badge/HTMX-2.0-3366CC?style=for-the-badge&logo=htmx&logoColor=white" alt="HTMX"/>
  <img src="https://img.shields.io/badge/Tailwind_CSS-4.0-06B6D4?style=for-the-badge&logo=tailwindcss&logoColor=white" alt="Tailwind CSS"/>
  <img src="https://img.shields.io/badge/Railway-Deploy-0B0D0E?style=for-the-badge&logo=railway&logoColor=white" alt="Railway"/>
  <img src="https://img.shields.io/badge/License-MIT-yellow?style=for-the-badge" alt="MIT License"/>
</p>

<h1 align="center">âš¡ Structo URL Shortener</h1>

<p align="center">
  <strong>A modern, production-ready URL shortening service built with Django 6, django-ninja, HTMX, and Tailwind CSS.</strong>
</p>

<p align="center">
  Shorten URLs instantly Â· Track every click with detailed analytics Â· Beautiful dark-themed UI Â· Full REST API with interactive docs
</p>

---

## âœ¨ Features

| Feature | Description |
|---------|-------------|
| **Instant URL Shortening** | Shorten any URL in milliseconds â€” no account required |
| **Custom Short Codes** | Authenticated users can choose branded slugs (e.g., `/my-brand`) |
| **QR Code Generation** | Automatic SVG QR code for every shortened link |
| **Detailed Analytics** | Click tracking with browser, OS, device, country, referrer, and time-series charts |
| **User Dashboard** | Manage all your links, view click counts, copy/share/delete with one click |
| **REST API** | Full API with auto-generated interactive Swagger/OpenAPI docs at `/api/docs` |
| **Dark Theme UI** | Beautiful, responsive dark-mode frontend with smooth HTMX transitions |
| **Production Ready** | Containerized, security-hardened, Railway-deployable in minutes |

---

## ğŸ›  Tech Stack

| Layer | Technology |
|-------|-----------|
| **Backend** | [Django 6.0](https://www.djangoproject.com/) â€” Python web framework |
| **API** | [django-ninja](https://django-ninja.dev/) â€” Fast REST API with Pydantic + auto OpenAPI docs |
| **Frontend** | [HTMX 2.0](https://htmx.org/) + [Tailwind CSS](https://tailwindcss.com/) â€” server-driven reactive UI |
| **Forms** | [django-widget-tweaks](https://github.com/jazzband/django-widget-tweaks) â€” Tailwind-styled form fields |
| **Charts** | [Chart.js 4](https://www.chartjs.org/) â€” click analytics visualizations |
| **Database** | PostgreSQL (prod) / SQLite (dev) via [dj-database-url](https://github.com/jazzband/dj-database-url) |
| **Static Files** | [WhiteNoise](https://whitenoise.readthedocs.io/) â€” compressed, cached static serving |
| **WSGI Server** | [Gunicorn](https://gunicorn.org/) â€” production multi-worker server |
| **Analytics** | [user-agents](https://github.com/selwin/python-user-agents) â€” browser/OS/device parsing |
| **QR Codes** | [qrcode](https://github.com/lincolnloop/python-qrcode) â€” inline SVG generation |
| **Package Manager** | [uv](https://docs.astral.sh/uv/) â€” 10-100x faster than pip, by Astral |
| **Linting** | [Ruff](https://docs.astral.sh/ruff/) â€” fast Python linter + formatter |
| **Testing** | [pytest](https://pytest.org/) + [pytest-django](https://pytest-django.readthedocs.io/) |
| **Deployment** | [Railway](https://railway.com/) / Docker |

---

## ğŸ“¸ Screenshots

<details>
<summary><strong>Homepage â€” URL Shortener</strong></summary>
<br>
The landing page features a clean dark-themed UI with a gradient hero section, URL input with HTMX-powered instant shortening, and feature cards.
</details>

<details>
<summary><strong>Result â€” Short URL + QR Code</strong></summary>
<br>
After shortening, users see the short URL with a copy button, inline SVG QR code, and share options â€” all rendered as an HTMX partial without page reload.
</details>

<details>
<summary><strong>Dashboard â€” Manage Links</strong></summary>
<br>
Authenticated users get a full dashboard table showing all their links, click counts, copy/analytics/delete actions, and custom code badges.
</details>

<details>
<summary><strong>Analytics â€” Click Tracking</strong></summary>
<br>
Detailed analytics page with summary cards, Chart.js time-series graph, and breakdown bars for browsers, OS, devices, countries, and referrers.
</details>

<details>
<summary><strong>API Docs â€” Swagger UI</strong></summary>
<br>
Interactive API documentation auto-generated by django-ninja at <code>/api/docs</code> with try-it-out functionality for all endpoints.
</details>

---

## ğŸš€ Quick Start

### Prerequisites

- **Python 3.13+**
- **[uv](https://docs.astral.sh/uv/getting-started/installation/)** â€” install with `curl -LsSf https://astral.sh/uv/install.sh | sh`

### Local Development

```bash
# 1. Clone the repository
git clone https://github.com/your-username/StructoUrlShortener.git
cd StructoUrlShortener

# 2. Install dependencies
uv sync

# 3. Run migrations
uv run python manage.py migrate

# 4. Create a superuser
uv run python manage.py createsuperuser

# 5. Start the development server
uv run python manage.py runserver
```

Open [http://localhost:8000](http://localhost:8000) â€” you're ready to go!

- **Homepage:** [http://localhost:8000](http://localhost:8000)
- **API Docs:** [http://localhost:8000/api/docs](http://localhost:8000/api/docs)
- **Admin Panel:** [http://localhost:8000/admin/](http://localhost:8000/admin/)
- **Dashboard:** [http://localhost:8000/dashboard/](http://localhost:8000/dashboard/) *(login required)*

---

## ğŸ³ Docker

### Using Docker Compose (recommended for local dev)

```bash
# Start Django + PostgreSQL
docker compose up --build

# In another terminal â€” run migrations
docker compose exec web python manage.py migrate
docker compose exec web python manage.py createsuperuser
```

### Using Dockerfile only

```bash
docker build -t structo .
docker run -p 8000:8000 \
  -e SECRET_KEY=your-secret-key \
  -e DATABASE_URL=postgres://user:pass@host:5432/dbname \
  -e DJANGO_SETTINGS_MODULE=config.settings.production \
  structo
```

---

## ğŸ“¡ API Reference

Interactive docs with try-it-out: **[/api/docs](http://localhost:8000/api/docs)**

### Endpoints

| Method | Endpoint | Auth | Description |
|--------|----------|------|-------------|
| `POST` | `/api/shorten` | Optional | Shorten a URL (custom codes require auth) |
| `GET` | `/api/urls/{code}` | No | Get info about a shortened URL |
| `GET` | `/api/urls/` | Required | List your shortened URLs |
| `DELETE` | `/api/urls/{code}` | Required | Deactivate a shortened URL |
| `GET` | `/api/urls/{code}/analytics` | Required | Detailed click analytics |

### Example: Shorten a URL

```bash
curl -X POST http://localhost:8000/api/shorten \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com/very/long/path"}'
```

**Response (201):**

```json
{
  "short_code": "k4m7bnx",
  "short_url": "http://localhost:8000/k4m7bnx",
  "original_url": "https://example.com/very/long/path",
  "created_at": "2026-02-07T12:00:00Z",
  "click_count": 0,
  "is_custom_code": false,
  "qr_code_svg": "<svg ...>...</svg>"
}
```

### Example: Custom Short Code (authenticated)

```bash
curl -X POST http://localhost:8000/api/shorten \
  -H "Content-Type: application/json" \
  -H "Cookie: sessionid=your-session-id" \
  -d '{"url": "https://example.com", "custom_code": "my-brand"}'
```

---

## ğŸ— Project Structure

```
StructoUrlShortener/
â”œâ”€â”€ config/                    # Django project configuration
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”œâ”€â”€ base.py            # Shared settings
â”‚   â”‚   â”œâ”€â”€ development.py     # SQLite, DEBUG=True
â”‚   â”‚   â””â”€â”€ production.py      # PostgreSQL, security headers
â”‚   â”œâ”€â”€ urls.py                # Root URL routing
â”‚   â”œâ”€â”€ wsgi.py
â”‚   â””â”€â”€ asgi.py
â”œâ”€â”€ shortener/                 # Core URL shortener app
â”‚   â”œâ”€â”€ models.py              # ShortenedURL model
â”‚   â”œâ”€â”€ api.py                 # django-ninja REST API
â”‚   â”œâ”€â”€ schemas.py             # Pydantic request/response schemas
â”‚   â”œâ”€â”€ views.py               # HTMX-powered web views
â”‚   â”œâ”€â”€ services.py            # Business logic layer
â”‚   â”œâ”€â”€ utils.py               # Short code generation
â”‚   â”œâ”€â”€ forms.py               # Django forms
â”‚   â”œâ”€â”€ admin.py               # Admin configuration
â”‚   â””â”€â”€ tests/                 # Test suite
â”‚       â”œâ”€â”€ test_api.py
â”‚       â”œâ”€â”€ test_models.py
â”‚       â””â”€â”€ test_services.py
â”œâ”€â”€ analytics/                 # Click analytics app
â”‚   â”œâ”€â”€ models.py              # ClickEvent model
â”‚   â”œâ”€â”€ services.py            # Click tracking + UA/geo parsing
â”‚   â”œâ”€â”€ views.py               # Analytics dashboard views
â”‚   â”œâ”€â”€ admin.py
â”‚   â””â”€â”€ tests/
â”‚       â””â”€â”€ test_analytics.py
â”œâ”€â”€ templates/                 # Django templates
â”‚   â”œâ”€â”€ base.html              # Base layout (nav, footer, HTMX, Tailwind)
â”‚   â”œâ”€â”€ 404.html / 500.html    # Error pages
â”‚   â”œâ”€â”€ shortener/
â”‚   â”‚   â”œâ”€â”€ home.html          # Landing page
â”‚   â”‚   â”œâ”€â”€ dashboard.html     # User link management
â”‚   â”‚   â””â”€â”€ partials/          # HTMX partial responses
â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â””â”€â”€ detail.html        # Analytics dashboard + Chart.js
â”‚   â””â”€â”€ registration/
â”‚       â”œâ”€â”€ login.html
â”‚       â””â”€â”€ register.html
â”œâ”€â”€ static/                    # Static assets
â”œâ”€â”€ pyproject.toml             # uv deps, pytest, ruff config
â”œâ”€â”€ uv.lock                    # Deterministic lockfile
â”œâ”€â”€ Dockerfile                 # Multi-stage production build
â”œâ”€â”€ docker-compose.yml         # Local dev (Django + PostgreSQL)
â”œâ”€â”€ railway.toml               # Railway deployment config
â”œâ”€â”€ nixpacks.toml              # Nixpacks build config
â””â”€â”€ .env.example               # Environment variables template
```

---

## ğŸš„ Deploy to Railway

### One-Click Deploy

1. **Push** this repository to GitHub
2. Go to [railway.com](https://railway.com) â†’ **New Project** â†’ **Deploy from GitHub Repo**
3. Select this repository
4. **Add a PostgreSQL** database from the Railway dashboard
5. Set the following **environment variables:**

| Variable | Value |
|----------|-------|
| `DJANGO_SETTINGS_MODULE` | `config.settings.production` |
| `SECRET_KEY` | *(generate a random key)* |
| `ALLOWED_HOSTS` | `your-app.up.railway.app` |
| `CSRF_TRUSTED_ORIGINS` | `https://your-app.up.railway.app` |
| `SITE_DOMAIN` | `https://your-app.up.railway.app` |
| `DATABASE_URL` | *(auto-provided by Railway Postgres)* |

1. Railway auto-detects the config from `nixpacks.toml`, runs migrations, and deploys

### Generate a Secret Key

```bash
python -c "import secrets; print(secrets.token_urlsafe(50))"
```

---

## ğŸ§ª Testing

```bash
# Run full test suite (46 tests)
uv run pytest

# Run with verbose output
uv run pytest -v

# Run specific test file
uv run pytest shortener/tests/test_api.py

# Run with coverage
uv run pytest --tb=short
```

### Test Coverage

| Module | Tests | Coverage |
|--------|-------|----------|
| `shortener/models` | 7 tests | Model creation, uniqueness, expiry, relationships |
| `shortener/services` | 14 tests | URL creation, resolution, custom codes, validation |
| `shortener/api` | 8 tests | API endpoints, auth, error handling |
| `analytics/services` | 7 tests | Click tracking, UA parsing, IP extraction |
| **Total** | **46 tests** | **All passing** |

---

## ğŸ”§ Configuration

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `DJANGO_SETTINGS_MODULE` | `config.settings.development` | Settings module to use |
| `SECRET_KEY` | *(dev key)* | Django secret key (**required in prod**) |
| `DATABASE_URL` | SQLite (dev) | Database connection string |
| `SITE_DOMAIN` | `http://localhost:8000` | Domain for generating short URLs |
| `ALLOWED_HOSTS` | `*` | Comma-separated allowed hosts |
| `CSRF_TRUSTED_ORIGINS` | *(empty)* | Comma-separated trusted origins |
| `CORS_ALLOWED_ORIGINS` | *(empty)* | Comma-separated CORS origins |
| `SHORTENER_CODE_LENGTH` | `7` | Default short code length |
| `SHORTENER_MAX_RETRIES` | `5` | Max retries on code collision |
| `LOG_LEVEL` | `INFO` | Logging level |
| `SECURE_SSL_REDIRECT` | `true` | Redirect HTTP â†’ HTTPS (prod) |
| `DB_SSL_REQUIRE` | `true` | Require SSL for DB connection (prod) |

### Settings Architecture

- **`config/settings/base.py`** â€” Shared: installed apps, middleware, templates, auth, static files
- **`config/settings/development.py`** â€” `DEBUG=True`, SQLite, console email, permissive CORS
- **`config/settings/production.py`** â€” PostgreSQL, WhiteNoise, HSTS, secure cookies, logging

---

## ğŸ” Security

Production settings include:

- âœ… `SECURE_SSL_REDIRECT` â€” force HTTPS
- âœ… `SECURE_HSTS_SECONDS` â€” 1 year HSTS with preload
- âœ… `SESSION_COOKIE_SECURE` / `CSRF_COOKIE_SECURE` â€” secure-only cookies
- âœ… `SECURE_CONTENT_TYPE_NOSNIFF` â€” prevent MIME sniffing
- âœ… `SECURE_PROXY_SSL_HEADER` â€” trust Railway's reverse proxy
- âœ… WhiteNoise with `CompressedManifestStaticFilesStorage` â€” hashed filenames + gzip/brotli
- âœ… Non-root Docker user
- âœ… Cryptographically secure short codes via `secrets` module
- âœ… Custom codes validated (3-20 chars, alphanumeric + hyphens, no ambiguous characters)

---

## ğŸ“Š Analytics Tracking

Every redirect captures:

| Data Point | Method |
|------------|--------|
| **IP Address** | `X-Forwarded-For` header (proxy-aware) |
| **Country / City** | GeoIP2 local database *(optional, graceful degradation)* |
| **Browser** | User-Agent parsing via `user-agents` |
| **Operating System** | User-Agent parsing |
| **Device Type** | Mobile / Tablet / Desktop / Bot / Unknown |
| **Referrer** | `HTTP_REFERER` header |
| **Timestamp** | Server-side UTC timestamp |

Analytics are displayed with Chart.js time-series graphs and color-coded progress bars for each category.

---

## ğŸ§‘â€ğŸ’» Development

### Code Quality

```bash
# Lint
uv run ruff check .

# Auto-fix lint issues
uv run ruff check --fix .

# Format code
uv run ruff format .
```

### Useful Management Commands

```bash
# Create migrations after model changes
uv run python manage.py makemigrations

# Apply migrations
uv run python manage.py migrate

# Create superuser
uv run python manage.py createsuperuser

# Collect static files (production)
uv run python manage.py collectstatic --noinput

# Django shell
uv run python manage.py shell
```

---

## ğŸ“„ License

This project is licensed under the **MIT License**. See [LICENSE](LICENSE) for details.

---

<p align="center">
  Built with â¤ï¸ using Django 6, django-ninja, HTMX, and Tailwind CSS
</p>
